---
name: custom-compact
description: Interactively create a summary of the current session and compact the context
arguments:
---

## フェーズ 1：初期分析

1. **現在のセッション**（このコンテキスト内）を以下の `<analysis>` タグで分析します：

   ```
   <analysis>
   - 各メッセージを時系列で分析
   - ユーザーの明確なリクエストと意図を特定
   - 技術的な決定事項とパターンを記録
   - すべてのファイル、コード変更、エラーを列挙
   - ユーザーからのフィードバックや修正の指摘を追跡
   </analysis>
   ```

2. 上記分析に基づき、以下のようにタイムラインフェーズを提示します：

   ```
   セッションタイムライン分析:

   [フェーズ1] [説明的なタイトル]
   - [重要なポイント1]
   - [重要なポイント2]

   [フェーズ2] [説明的なタイトル]
   - [重要なポイント1]
   - [重要なポイント2]

   このフェーズ分けは適切でしょうか？修正があれば教えてください。
   ```

---

## フェーズ 2：対話的レビュー

3. 各フェーズの内容を以下の形式でユーザーと確認します：

   ```
   [フェーズXのレビュー]

   主な内容:
   - [このフェーズで話した具体的なトピック]
   - [試したアプローチ]

   主な決定事項:
   - [決定1]
   - [決定2]

   技術的な詳細:
   - 変更したファイル: [ファイル一覧]
   - 主なコード変更: [簡単な説明]

   発生したエラー:
   - [エラー内容とその修正]

   この要約は正確でしょうか？追加・修正点があれば教えてください。
   ```

**重要**：

- **この会話コンテキスト**の中だけを対象としてください
- `get-current-session-log`などのツールは使用しないでください
- 各フェーズの確認後、必ずユーザーの同意を得てから次に進んでください

---

## フェーズ 3：詳細な技術要約

4. フェーズレビューを通過したら、以下のような詳細技術要約を作成します：

   ````
   <summary>
   1. 主なリクエストと意図:
      [フェーズに基づく詳細な記述]

   2. 重要な技術的コンセプト:
      - [コンセプト1]
      - [コンセプト2]

   3. ファイルとコード部分:
      - [ファイル名1]
         - このファイルの重要性
         - 実施した変更内容
         - ```[言語]
           [コードスニペット]
           ```
      - [ファイル名2]
         - 重要なポイントなど

   4. エラーと修正内容:
      - [エラー内容]:
        - 修正方法: [どのように解決したか]
        - ユーザーフィードバック: [あれば記載]

   5. 問題解決のプロセス:
      [試行錯誤や解決までの流れ]

   6. ユーザーの全メッセージ（ツール以外）:
      - "[ユーザーのメッセージ1]"
      - "[ユーザーのメッセージ2]"

   7. セッションタイムライン:
      [先ほど確認されたフェーズ要約]

   8. 未完了のタスク:
      - [ ] [タスク1]
      - [ ] [タスク2]

   9. 現在の作業内容:
      [compact前に取り組んでいた内容]

   10. 次のステップ:
       [ユーザーの意図と一致する場合のみ記載]
   </summary>

   この要約はコンパクト処理に使用してよろしいでしょうか？
   ````

---

## フェーズ 4：最終確認と実行

5. 最終確認メッセージを表示します：

   ```
   上記の要約を使ってコンテキストをコンパクト化します。
   実行すると、これまでの詳細な会話履歴はアクセスできなくなりますが、
   要約は保存されます。

   実行してよろしいですか？（yes/no）
   ```

   ※必ず明確な「yes」の返答を待ってください。

6. コンパクト処理の実行：

   - 承認された要約で `custom-compact` を使用します
   - 完了を確認し、以下を伝えます：

     ```
     コンテキストはコンパクト化されました。
     要約を引き継いで作業を続けるには、このセッションを閉じて次を実行してください:
     claude --continue
     ```

---

### 注意点：

- 対話的なレビューと技術的分析を必ず組み合わせること
- 高レベルなフェーズと詳細な技術内容の両方を含めること
- ユーザーの言語を常に尊重し、それに合わせて応答すること
- この操作は**破壊的処理**なので、**明示的な承認**が必要です
- 最終的な要約は、セッションを復元せずに作業を再開できるレベルの網羅性が必要です
